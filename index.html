<!DOCTYPE html>
<html>
<head>
    <title>Color Chase Game</title>
    <style>
        /* Original functionality with enhanced, animated visuals */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            touch-action: manipulation;
            background: linear-gradient(-45deg, #ff0066, #ffcc00, #33ccff, #33ff99);
            background-size: 400% 400%;
            animation: gradientFlow 15s ease infinite, pulseBackground 5s ease infinite;
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes pulseBackground {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* Canvas stays as original */
        canvas {
            background: rgba(255, 255, 255, 0.9);
            display: block;
            position: absolute;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid #fff;
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(0,0,0,0.3);
        }

        /* On-screen directional controls (Left, Jump, Right) */
        #controls {
            position: fixed;
            bottom: 5vh;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10vw;
            z-index: 100;
        }

        button {
            font-size: 15vw;
            cursor: pointer;
            border: none;
            width: 30vw;
            height: 30vw;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.9);
            color: #000;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
            transition: all 0.1s;
        }

        button:active {
            transform: scale(0.85);
            background: rgba(255,255,255,0.7);
        }

        /* Scoreboard (unchanged) */
        #scoreBoard {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 6vw;
            background: rgba(0,0,0,0.5);
            padding: 2vw 4vw;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(5px);
        }

        /* Game over message (unchanged) */
        #gameOverMessage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 4vw;
            display: none;
            z-index: 200;
        }

        /* Instructions restored from original with a subtle gradient border */
        #instructions {
            position: fixed;
            bottom: 40vh;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 3vw;
            color: #333;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
            z-index: 100;
            border: 3px solid;
            border-image: linear-gradient(45deg, #ff0066, #33ccff) 1;
        }

        #instructions h2 {
            margin: 0 0 10px;
            font-size: 4vw;
            color: #ff3366;
        }

        #instructions p {
            margin: 5px 0;
        }

        #instructions a {
            color: #23a6d5;
            text-decoration: none;
            font-weight: bold;
        }

        #instructions a:hover {
            text-decoration: underline;
        }

        /* Game controls (Play, Pause, Restart) restored with subtle gradient border */
        #gameControls {
            position: fixed;
            bottom: 20vh;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5vw;
            z-index: 100;
        }

        #gameControls button {
            font-size: 5vw;
            width: 20vw;
            height: 20vw;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.9);
            color: #000;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            border: 3px solid;
            border-image: linear-gradient(45deg, #ff0066, #33ccff) 1;
        }

        #gameControls button span {
            font-size: 3vw;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div id="scoreBoard">
        <div>‚≠ê SCORE: <span id="score">0</span></div>
        <div>üèÜ HIGH: <span id="highScore">0</span></div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <div id="instructions">
        <h2>How to Play</h2>
        <p>Use the <strong>‚¨ÖÔ∏è</strong> and <strong>‚û°Ô∏è</strong> buttons to move left and right.</p>
        <p>Press the <strong>ü¶ò</strong> button to jump.</p>
        <p>Avoid obstacles and collect coins to score points!</p>
        <p>Made with ‚ù§Ô∏è by <a href="https://t.me/asrahi_07" target="_blank" onclick="window.open('https://t.me/asrahi_07', '_blank'); return false;">AS Rahi</a></p>
    </div>
    <div id="gameControls">
        <button id="playButton">
            ‚ñ∂Ô∏è
            <span>Play</span>
        </button>
        <button id="pauseButton">
            ‚è∏Ô∏è
            <span>Pause</span>
        </button>
        <button id="restartButton">
            üîÑ
            <span>Restart</span>
        </button>
    </div>
    <div id="controls">
        <button id="left">‚¨ÖÔ∏è</button>
        <button id="jump">ü¶ò</button>
        <button id="right">‚û°Ô∏è</button>
    </div>

    <div id="gameOverMessage">
        <p id="performanceText"></p>
    </div>

    <script>
        // Game initialization
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800;
        canvas.height = 400;

        let gameState = {
            player: { x: 200, y: 300, dx: 0, dy: 0, jumpCount: 0 },
            obstacles: [],
            coins: [],
            score: 0,
            highScore: localStorage.getItem('highScore') || 0,
            isGameOver: false,
            isPaused: false
        };

        // Update high score display
        document.getElementById('highScore').textContent = gameState.highScore;

        // Touch handling
        let activeTouches = new Set();

        document.addEventListener('touchstart', e => {
            e.preventDefault();
            Array.from(e.touches).forEach(touch => {
                const button = document.elementFromPoint(touch.clientX, touch.clientY);
                if (button) handleButtonPress(button.id);
            });
        });

        document.addEventListener('touchend', e => {
            e.preventDefault();
            activeTouches.clear();
        });

        document.addEventListener('mousedown', e => {
            if (e.target.closest('button')) handleButtonPress(e.target.id);
        });

        function handleButtonPress(id) {
            activeTouches.add(id);
            if (id === 'jump' && gameState.player.jumpCount < 2) {
                gameState.player.dy = -12;
                gameState.player.jumpCount++;
            } else if (id === 'playButton') {
                gameState.isPaused = false;
            } else if (id === 'pauseButton') {
                gameState.isPaused = true;
            } else if (id === 'restartButton') {
                resetGame();
            }
        }

        // Game loop
        function update() {
            if (gameState.isGameOver || gameState.isPaused) return;

            // Horizontal movement
            gameState.player.dx = 0;
            if (activeTouches.has('left')) gameState.player.dx = -7;
            if (activeTouches.has('right')) gameState.player.dx = 7;

            // Update positions
            gameState.player.x = Math.max(0, Math.min(canvas.width - 50, gameState.player.x + gameState.player.dx));
            gameState.player.y += gameState.player.dy;

            // Gravity
            if (gameState.player.y + 50 < 350) {
                gameState.player.dy += 0.5;
            } else {
                gameState.player.y = 300;
                gameState.player.dy = 0;
                gameState.player.jumpCount = 0;
            }

            // Update objects
            gameState.obstacles.forEach(o => o.x -= 5);
            gameState.coins.forEach(c => c.x -= 5);

            // Collision detection
            gameState.obstacles.forEach(obstacle => {
                if (checkCollision(gameState.player, obstacle)) {
                    gameOver();
                }
            });

            gameState.coins.forEach((coin, index) => {
                if (checkCollision(gameState.player, coin)) {
                    gameState.score += 3;
                    gameState.coins.splice(index, 1);
                    document.getElementById('score').textContent = gameState.score;
                }
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw player
            ctx.font = "60px Arial";
            ctx.fillStyle = "#ff3366";
            ctx.fillText('üòé', gameState.player.x, gameState.player.y);

            // Draw obstacles and coins
            ctx.font = "40px Arial";
            gameState.obstacles.forEach(o => {
                ctx.fillStyle = o.color;
                ctx.fillText(o.emoji, o.x, o.y);
            });
            gameState.coins.forEach(c => {
                ctx.fillStyle = "#ffd700";
                ctx.fillText('üí∞', c.x, c.y);
            });
        }

        function checkCollision(a, b) {
            return a.x < b.x + b.width &&
                   a.x + 50 > b.x &&
                   a.y < b.y + b.height &&
                   a.y + 50 > b.y;
        }

        function gameOver() {
            gameState.isGameOver = true;

            // Update high score
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                localStorage.setItem('highScore', gameState.highScore);
                document.getElementById('highScore').textContent = gameState.highScore;
            }

            // Show performance message
            const performanceText = document.getElementById('performanceText');
            const difference = gameState.highScore - gameState.score;
            let message;

            if (gameState.score === gameState.highScore) {
                message = "üéâ Wow! You're a LEGEND! üéâ<br>You just set a new high score!";
            } else if (difference <= 50) {
                message = "üò≤ So close! You were just " + difference + " points away from the high score!";
            } else if (difference <= 100) {
                message = "ü§î Not bad! But you're still " + difference + " points behind the high score.";
            } else {
                message = "üòÖ Oops! You're " + difference + " points away from the high score. Better luck next time!";
            }

            performanceText.innerHTML = `Game Over!<br>Your Score: ${gameState.score}<br>${message}`;
            document.getElementById('gameOverMessage').style.display = 'block';

            // Restart the game after 5 seconds
            setTimeout(() => {
                resetGame();
            }, 5000);
        }

        function resetGame() {
            gameState = {
                player: { x: 200, y: 300, dx: 0, dy: 0, jumpCount: 0 },
                obstacles: [],
                coins: [],
                score: 0,
                highScore: localStorage.getItem('highScore') || 0,
                isGameOver: false,
                isPaused: false
            };
            document.getElementById('score').textContent = 0;
            document.getElementById('gameOverMessage').style.display = 'none';
        }

        // Object creation
        setInterval(() => {
            if (!gameState.isGameOver && !gameState.isPaused) {
                gameState.obstacles.push({
                    x: canvas.width,
                    y: 320,
                    width: 50,
                    height: 50,
                    emoji: ["üöß","üöó","üëæ"][Math.floor(Math.random()*3)],
                    color: ["#ff5555","#55ff55","#8888ff"][Math.floor(Math.random()*3)]
                });
            }
        }, 2000);

        setInterval(() => {
            if (!gameState.isGameOver && !gameState.isPaused) {
                gameState.coins.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 150) + 50,
                    width: 30,
                    height: 30
                });
            }
        }, 1500);

        // Start game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
